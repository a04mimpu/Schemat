
<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kontorsschema Generator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const LockIcon = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
        );

        const UnlockIcon = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
            </svg>
        );

        const CalendarIcon = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const RotateIcon = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const DownloadIcon = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const OfficeScheduler = () => {
            const people = ['Gunilla', 'Minethe', 'Lennart', 'Carl'];
            const weekdays = ['Måndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag'];
            const locations = { H: 'Hisingen', F: 'Frölunda', HOME: 'Hemma', AWAY: 'Ledig' };

            const [schedule, setSchedule] = useState({});
            const [locked, setLocked] = useState({});
            const [stats, setStats] = useState({});
            const [weekNumber, setWeekNumber] = useState(1);
            const [startDate, setStartDate] = useState('');

            useEffect(() => {
                const initialStats = {};
                people.forEach(person => {
                    initialStats[person] = { H: 0, F: 0, HOME: 0 };
                });
                setStats(initialStats);
            }, []);

            const generateSchedule = () => {
                const newSchedule = {};
                const availability = {};
                
                weekdays.forEach(day => {
                    availability[day] = people.filter(person => {
                        const key = `${person}-${day}`;
                        return locked[key] !== 'AWAY';
                    });
                });

                const workingStats = JSON.parse(JSON.stringify(stats));

                weekdays.forEach(day => {
                    const availablePeople = [...availability[day]];
                    const dailyAssignments = {};

                    people.forEach(person => {
                        const key = `${person}-${day}`;
                        if (locked[key] && locked[key] !== 'AWAY') {
                            dailyAssignments[person] = locked[key];
                            const index = availablePeople.indexOf(person);
                            if (index > -1) availablePeople.splice(index, 1);
                        }
                    });

                    const assigned = Object.values(dailyAssignments);
                    let hCount = assigned.filter(loc => loc === 'H').length;
                    let fCount = assigned.filter(loc => loc === 'F').length;
                    let homeCount = assigned.filter(loc => loc === 'HOME').length;

                    const needH = Math.max(0, 1 - hCount);
                    const needF = Math.max(0, 2 - fCount);
                    const needHome = Math.max(0, 1 - homeCount);

                    const sortByNeed = (location) => {
                        return [...availablePeople].sort((a, b) => {
                            return workingStats[a][location] - workingStats[b][location];
                        });
                    };

                    if (needH > 0) {
                        const candidates = sortByNeed('H');
                        for (let i = 0; i < needH && candidates.length > 0; i++) {
                            const person = candidates.shift();
                            dailyAssignments[person] = 'H';
                            workingStats[person].H++;
                            const index = availablePeople.indexOf(person);
                            if (index > -1) availablePeople.splice(index, 1);
                        }
                    }

                    if (needF > 0) {
                        const candidates = sortByNeed('F');
                        for (let i = 0; i < needF && candidates.length > 0; i++) {
                            const person = candidates.shift();
                            dailyAssignments[person] = 'F';
                            workingStats[person].F++;
                            const index = availablePeople.indexOf(person);
                            if (index > -1) availablePeople.splice(index, 1);
                        }
                    }

                    if (needHome > 0) {
                        const candidates = sortByNeed('HOME');
                        for (let i = 0; i < needHome && candidates.length > 0; i++) {
                            const person = candidates.shift();
                            dailyAssignments[person] = 'HOME';
                            workingStats[person].HOME++;
                            const index = availablePeople.indexOf(person);
                            if (index > -1) availablePeople.splice(index, 1);
                        }
                    }

                    newSchedule[day] = dailyAssignments;
                });

                setSchedule(newSchedule);
                setStats(workingStats);
            };

            const toggleLock = (person, day) => {
                const key = `${person}-${day}`;
                setLocked(prev => {
                    const newLocked = { ...prev };
                    if (newLocked[key]) {
                        delete newLocked[key];
                    } else {
                        const currentLocation = schedule[day]?.[person];
                        if (currentLocation) {
                            newLocked[key] = currentLocation;
                        }
                    }
                    return newLocked;
                });
            };

            const setVacation = (person, day) => {
                const key = `${person}-${day}`;
                setLocked(prev => ({
                    ...prev,
                    [key]: prev[key] === 'AWAY' ? undefined : 'AWAY'
                }));
            };

            const resetStats = () => {
                const resetStats = {};
                people.forEach(person => {
                    resetStats[person] = { H: 0, F: 0, HOME: 0 };
                });
                setStats(resetStats);
                setWeekNumber(1);
            };

            const getLocationColor = (location) => {
                switch(location) {
                    case 'H': return 'bg-pink-100 text-pink-800';
                    case 'F': return 'bg-green-100 text-green-800';
                    case 'HOME': return 'bg-blue-100 text-blue-800';
                    case 'AWAY': return 'bg-gray-200 text-gray-600';
                    default: return 'bg-white';
                }
            };

            const exportToExcel = () => {
                let csv = 'Vecka:,' + weekNumber + '\n';
                csv += 'Startdatum:,' + (startDate || 'Ej angivet') + '\n\n';
                csv += 'Person,' + weekdays.join(',') + '\n';
                
                people.forEach(person => {
                    const row = [person];
                    weekdays.forEach(day => {
                        const location = schedule[day]?.[person];
                        row.push(location || '');
                    });
                    csv += row.join(',') + '\n';
                });

                csv += '\nStatistik\n';
                csv += 'Person,Hisingen,Frölunda,Hemma\n';
                people.forEach(person => {
                    csv += `${person},${stats[person]?.H || 0},${stats[person]?.F || 0},${stats[person]?.HOME || 0}\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `schema_vecka_${weekNumber}.csv`;
                link.click();
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-xl shadow-2xl p-8">
                            <div className="flex items-center justify-between mb-8">
                                <div className="flex items-center gap-3">
                                    <CalendarIcon className="w-8 h-8 text-indigo-600" />
                                    <h1 className="text-3xl font-bold text-gray-800">Kontorsschema Generator</h1>
                                </div>
                                <div className="text-sm text-gray-500">
                                    <div className="flex gap-4 items-center">
                                        <div>
                                            <label className="block text-xs font-medium mb-1">Vecka:</label>
                                            <input 
                                                type="number" 
                                                value={weekNumber} 
                                                onChange={(e) => setWeekNumber(parseInt(e.target.value) || 1)}
                                                className="w-20 px-2 py-1 border rounded"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-medium mb-1">Startdatum:</label>
                                            <input 
                                                type="date" 
                                                value={startDate} 
                                                onChange={(e) => setStartDate(e.target.value)}
                                                className="px-2 py-1 border rounded"
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-4 mb-6">
                                <button
                                    onClick={generateSchedule}
                                    className="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2"
                                >
                                    <RotateIcon className="w-5 h-5" />
                                    Generera Schema
                                </button>
                                <button
                                    onClick={resetStats}
                                    className="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors"
                                >
                                    Nollställ Statistik
                                </button>
                                {Object.keys(schedule).length > 0 && (
                                    <button
                                        onClick={exportToExcel}
                                        className="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center gap-2"
                                    >
                                        <DownloadIcon className="w-5 h-5" />
                                        Exportera
                                    </button>
                                )}
                            </div>

                            <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                                <h3 className="font-semibold text-gray-700 mb-2">Instruktioner:</h3>
                                <ul className="text-sm text-gray-600 space-y-1">
                                    <li>• Klicka på "Generera Schema" för att skapa ett nytt veckoschema</li>
                                    <li>• Klicka på en ruta för att markera som ledig (grå)</li>
                                    <li>• Klicka på låsikonen för att låsa ett pass</li>
                                    <li>• Statistiken visar total fördelning över alla genererade veckor</li>
                                </ul>
                            </div>

                            {Object.keys(schedule).length > 0 && (
                                <>
                                    <div className="overflow-x-auto">
                                        <table className="w-full border-collapse">
                                            <thead>
                                                <tr className="bg-gray-100">
                                                    <th className="border border-gray-300 p-3 text-left font-semibold">Person</th>
                                                    {weekdays.map(day => (
                                                        <th key={day} className="border border-gray-300 p-3 text-center font-semibold">
                                                            {day}
                                                        </th>
                                                    ))}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {people.map(person => (
                                                    <tr key={person} className="hover:bg-gray-50">
                                                        <td className="border border-gray-300 p-3 font-medium">{person}</td>
                                                        {weekdays.map(day => {
                                                            const location = schedule[day]?.[person];
                                                            const key = `${person}-${day}`;
                                                            const isLocked = locked[key] && locked[key] !== 'AWAY';
                                                            const isAway = locked[key] === 'AWAY';
                                                            
                                                            return (
                                                                <td 
                                                                    key={day} 
                                                                    className="border border-gray-300 p-1"
                                                                >
                                                                    <div className="flex items-center justify-center gap-1">
                                                                        <button
                                                                            onClick={() => setVacation(person, day)}
                                                                            className={`flex-1 py-2 px-3 rounded font-medium text-center cursor-pointer ${
                                                                                isAway ? 'bg-gray-200 text-gray-600' : getLocationColor(location)
                                                                            }`}
                                                                        >
                                                                            {isAway ? 'Ledig' : location || '-'}
                                                                        </button>
                                                                        <button
                                                                            onClick={() => toggleLock(person, day)}
                                                                            className={`p-2 rounded ${
                                                                                isLocked ? 'text-yellow-600 hover:text-yellow-700' : 'text-gray-400 hover:text-gray-600'
                                                                            }`}
                                                                            title={isLocked ? 'Låst' : 'Lås position'}
                                                                        >
                                                                            {isLocked ? <LockIcon className="w-4 h-4" /> : <UnlockIcon className="w-4 h-4" />}
                                                                        </button>
                                                                    </div>
                                                                </td>
                                                            );
                                                        })}
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>

                                    <div className="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="bg-gray-50 p-6 rounded-lg">
                                            <h3 className="font-bold text-lg mb-4 text-gray-800">Statistik (Alla veckor)</h3>
                                            <table className="w-full text-sm">
                                                <thead>
                                                    <tr className="border-b border-gray-300">
                                                        <th className="text-left py-2">Person</th>
                                                        <th className="text-center py-2">Hisingen</th>
                                                        <th className="text-center py-2">Frölunda</th>
                                                        <th className="text-center py-2">Hemma</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {people.map(person => (
                                                        <tr key={person} className="border-b border-gray-200">
                                                            <td className="py-2 font-medium">{person}</td>
                                                            <td className="text-center py-2">{stats[person]?.H || 0}</td>
                                                            <td className="text-center py-2">{stats[person]?.F || 0}</td>
                                                            <td className="text-center py-2">{stats[person]?.HOME || 0}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>

                                        <div className="bg-gray-50 p-6 rounded-lg">
                                            <h3 className="font-bold text-lg mb-4 text-gray-800">Denna vecka</h3>
                                            <div className="space-y-2 text-sm">
                                                {weekdays.map(day => {
                                                    const daySchedule = schedule[day] || {};
                                                    const hPeople = Object.entries(daySchedule).filter(([_, loc]) => loc === 'H').map(([p]) => p);
                                                    const fPeople = Object.entries(daySchedule).filter(([_, loc]) => loc === 'F').map(([p]) => p);
                                                    const homePeople = Object.entries(daySchedule).filter(([_, loc]) => loc === 'HOME').map(([p]) => p);
                                                    
                                                    return (
                                                        <div key={day} className="pb-2 border-b border-gray-200">
                                                            <div className="font-medium text-gray-700">{day}:</div>
                                                            <div className="ml-4 text-gray-600">
                                                                <div>Hisingen: {hPeople.join(', ') || '-'}</div>
                                                                <div>Frölunda: {fPeople.join(', ') || '-'}</div>
                                                                <div>Hemma: {homePeople.join(', ') || '-'}</div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<OfficeScheduler />, document.getElementById('root'));
    </script>
</body>
</html>
